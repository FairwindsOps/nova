name: Nova Tests
description: Collection of e2e tests for Nova.
testcases:
- name: install helm charts
  steps:
  - script: |
      helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
      helm repo update
      helm install ingress-nginx-latest ingress-nginx/ingress-nginx --set controller.ingressClassResource.name=nginx-latest
      helm install --version 4.6.0 ingress-nginx-old ingress-nginx/ingress-nginx
    assertions:
    - result.code ShouldEqual 0

- name: nova_run
  steps:
  - type: exec
    script: |
      nova find --output-file output.json
      cat ./output.json

- name: validate outdated chart version
  steps:
  - type: exec
    script: |
      jq '.helm[] | select(.release == "ingress-nginx-old" and .outdated == true)' ./output.json
    assertions:
    - result.code ShouldEqual 0
    - result.systemoutjson ShouldNotBeEmpty

- name: validate latest chart version
  steps:
  - type: exec
    script: |
      jq '.helm[] | select(.release == "ingress-nginx-latest" and .outdated == false)' ./output.json
    assertions:
    - result.code ShouldEqual 0
    - result.systemoutjson ShouldNotBeEmpty
